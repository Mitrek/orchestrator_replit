Here’s a **clean, copy-paste prompt** you can feed into the Replit AI assistant. It addresses exactly what went wrong in Step 3:

---

**Prompt for Replit AI Assistant:**

We are in **Phase 9 — Step 3** of the Heatmap project. The smoketest shows two issues:

1. `/dev/heatmap` is serving the **Vite dev HTML** (with `/@vite/client`) instead of the built client (`client/dist/index.html`).
2. The smoke test expects **three static QA markers** in the HTML, but only the first two were present. The “Diagnostics” marker must also be there.

Please fix both issues with minimal changes, learning from earlier mistakes:

---

### A) Fix server static serving

* In `server/index.ts`, ensure we serve **only** from `client/dist` (not `client/`).
* Add a log line confirming the path (e.g. `[Phase9] Serving client from: …`).
* Code should look like:

```ts
import path from "path";
import fs from "fs";

const clientDist = path.resolve(process.cwd(), "client", "dist");
if (fs.existsSync(clientDist)) {
  console.log("[Phase9] Serving client from:", clientDist);
  app.use(express.static(clientDist));
  app.get("/dev/heatmap", (_req, res) => {
    res.sendFile(path.join(clientDist, "index.html"));
  });
} else {
  console.warn("[Phase9] client/dist not found; /dev/heatmap will 404 (safe).");
}
```

This guarantees `/dev/heatmap` serves the **built bundle**.

---

### B) Add missing QA marker

* In `client/index.html`, update the static QA marker block to include **three lines**:

```html
<!-- QA markers (static, for smoketest) -->
<div id="qa-markers" style="display:none">
  AI Heatmap — /api/v1/heatmap
  Data Heatmap — /api/v1/heatmap/data
  Diagnostics — /api/v1/heatmap/diagnostics
</div>
```

Keep these in `index.html` so smoketests can detect them without React.

---

### C) Rebuild and serve

1. Make sure `VITE_FEATURE_HEATMAP_DEV_UI=true` is set in Replit Secrets (not just a file).
2. Run:

```bash
npm --prefix client run build
```

3. Restart the server so it serves from `client/dist`.

---

### D) Verification

After changes:

* `/dev/heatmap` HTML should **not contain `/@vite/client`**, and should include all three markers.
* Step 3 smoketest should pass `[TEST 1] Dev UI route (React + markers)` and the rest.

Do not add PNG URLs or external screenshot providers — project is **base64-only**.

---

Please implement these exact changes and rebuild.
