Here’s a precise prompt you can paste into Replit’s AI to get this fixed cleanly:

---

**Prompt for Replit AI Assistant**

We need to fix Phase 9 Step 3 so that `/dev/heatmap` serves the **built client bundle** instead of the Vite dev HTML.

### The problem

* Smoke test shows `/dev/heatmap` returns HTML containing `/@vite/client`, which means it’s serving the source/dev index.html instead of the built one.
* Our Vite build emits the bundle to `dist/public` (root-level), e.g.:

  ```
  dist/public/index.html
  dist/public/assets/...
  ```
* But the server is currently looking in `client/dist` or falling back to the source file.

### Tasks

1. **Update `server/index.ts`:**

   * Import `path` and `fs`.
   * Resolve the correct path for built client:

     ```ts
     const distPublic = path.resolve(process.cwd(), "dist", "public");
     ```
   * If `dist/public` exists, serve static assets from there:

     ```ts
     app.use(express.static(distPublic));
     app.get("/dev/heatmap", (_req, res) => {
       res.sendFile(path.join(distPublic, "index.html"));
     });
     ```
   * If not found, log a warning but keep the server running.

2. **Remove or comment out** any old static serving pointing at `client/dist` or `client/index.html`.

3. **Ensure QA markers remain in `client/index.html`:**

   * These must appear in the built HTML for smoketests:

     * `AI Heatmap — /api/v1/heatmap`
     * `Data Heatmap — /api/v1/heatmap/data`
     * `Diagnostics — /api/v1/heatmap/diagnostics`

4. **Build step (manual after code change):**

   * In the Replit shell, run:

     ```bash
     npm --prefix client run build
     ls -la dist/public | sed -n '1,80p'
     ```
   * Confirm `dist/public/index.html` and assets exist.

5. **Restart the server** after the build. On startup it should log:

   ```
   [Phase9] Serving client from: /home/runner/workspace/dist/public
   ```

### Expected outcome

* `/dev/heatmap` should serve the built `dist/public/index.html` (with `/assets/...` links, **no `/@vite/client`**).
* Smoketest `[TEST 1]` should pass (QA markers found in correct built HTML).

---

Do you want me to also prepare a **quick smoketest variant** that explicitly checks that `/dev/heatmap` contains `/assets/` but not `/@vite/client`, so we know for sure it’s serving the built bundle?
